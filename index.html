<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>üêì Rooster Runner - Gioco Professionale</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Poppins:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            touch-action: none;
            overscroll-behavior: none;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameWrapper {
            width: 100vw;
            height: 100vh;
            height: 100dvh; /* Dynamic viewport height per mobile */
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            padding: 0;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                #87CEEB 0%, 
                #B0E0E6 30%,
                #F0F8FF 60%, 
                #90EE90 60%,
                #228B22 100%
            );
            overflow: hidden;
            box-shadow: 
                0 30px 80px rgba(0,0,0,0.5),
                inset 0 -10px 30px rgba(0,0,0,0.2);
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* SOLE */
        .sun {
            position: absolute;
            top: 40px;
            right: 80px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.8);
            animation: sunGlow 3s ease-in-out infinite;
            z-index: 5;
        }

        @keyframes sunGlow {
            0%, 100% { box-shadow: 0 0 60px rgba(255, 215, 0, 0.8); }
            50% { box-shadow: 0 0 100px rgba(255, 215, 0, 1); }
        }

        /* NUVOLE */
        .cloud {
            position: absolute;
            font-size: 50px;
            opacity: 0.8;
            z-index: 10;
        }

        .cloud1 {
            top: 80px;
            left: 10%;
            animation: cloudMove1 30s linear infinite;
        }

        .cloud2 {
            top: 120px;
            left: 50%;
            animation: cloudMove2 40s linear infinite;
        }

        .cloud3 {
            top: 60px;
            right: 20%;
            animation: cloudMove3 35s linear infinite;
        }

        @keyframes cloudMove1 {
            from { transform: translateX(0); }
            to { transform: translateX(-1500px); }
        }

        @keyframes cloudMove2 {
            from { transform: translateX(0); }
            to { transform: translateX(-1500px); }
        }

        @keyframes cloudMove3 {
            from { transform: translateX(0); }
            to { transform: translateX(-1500px); }
        }

        /* MONTAGNE */
        .mountain {
            position: absolute;
            bottom: 150px;
            font-size: 180px;
            opacity: 0.4;
            z-index: 5;
        }

        .mountain1 {
            left: 10%;
        }

        .mountain2 {
            left: 40%;
        }

        .mountain3 {
            right: 15%;
        }

        /* TERRENO - Altezza fissa responsive */
        #ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 120px;
            background: linear-gradient(to bottom, 
                #8B4513 0%,
                #654321 50%,
                #3D2817 100%
            );
            border-top: 5px solid #2F1810;
            box-shadow: inset 0 15px 30px rgba(0,0,0,0.3);
            z-index: 20;
        }

        @media (min-width: 768px) {
            #ground {
                height: 150px;
            }
        }

        @media (max-width: 480px) {
            #ground {
                height: 100px;
            }
        }

        /* ERBA */
        .grass-container {
            position: absolute;
            bottom: 115px;
            width: 100%;
            height: 40px;
            overflow: hidden;
            z-index: 25;
        }

        @media (min-width: 768px) {
            .grass-container {
                bottom: 145px;
            }
        }

        @media (max-width: 480px) {
            .grass-container {
                bottom: 95px;
            }
        }

        .grass {
            position: absolute;
            bottom: 0;
            font-size: 30px;
            animation: grassMove 3s linear infinite;
        }

        @keyframes grassMove {
            from { transform: translateX(0); }
            to { transform: translateX(-100px); }
        }

        /* GALLO - Dimensioni e posizione ottimizzate */
        #rooster {
            position: absolute;
            bottom: 120px;
            left: 100px;
            font-size: 70px;
            z-index: 50;
            filter: drop-shadow(5px 8px 12px rgba(0,0,0,0.5));
            transition: none;
            transform: scaleX(-1);
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        @media (min-width: 768px) {
            #rooster {
                font-size: 90px;
                bottom: 150px;
                left: 150px;
            }
        }

        @media (max-width: 480px) {
            #rooster {
                font-size: 55px;
                bottom: 100px;
                left: 80px;
            }
        }

        #rooster.running {
            animation: roosterWalk 0.3s steps(2) infinite;
        }

        @keyframes roosterWalk {
            0% { transform: scaleX(-1) translateY(0px); }
            50% { transform: scaleX(-1) translateY(-5px); }
            100% { transform: scaleX(-1) translateY(0px); }
        }

        /* OSTACOLI - Stessa altezza del gallo */
        .obstacle {
            position: absolute;
            bottom: 120px;
            font-size: 60px;
            filter: drop-shadow(3px 5px 8px rgba(0,0,0,0.4));
            z-index: 40;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            will-change: transform;
        }

        @media (min-width: 768px) {
            .obstacle {
                font-size: 70px;
                bottom: 150px;
            }
        }

        @media (max-width: 480px) {
            .obstacle {
                font-size: 50px;
                bottom: 100px;
            }
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.4) 0%, transparent 100%);
        }

        @media (min-width: 768px) {
            #hud {
                padding: 25px 35px;
            }
        }

        #scorePanel {
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.98) 0%, 
                rgba(240,240,250,0.98) 100%);
            padding: 15px 25px;
            border-radius: 18px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,1),
                0 0 20px rgba(102, 126, 234, 0.3);
            border: 2px solid rgba(255,255,255,0.6);
        }

        @media (min-width: 768px) {
            #scorePanel {
                padding: 22px 35px;
            }
        }

        #scorePanel h3 {
            font-size: 10px;
            color: #888;
            margin-bottom: 6px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        @media (min-width: 768px) {
            #scorePanel h3 {
                font-size: 14px;
                margin-bottom: 8px;
            }
        }

        #score {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Press Start 2P', cursive;
            filter: drop-shadow(0 2px 4px rgba(102, 126, 234, 0.3));
            transition: transform 0.3s ease, filter 0.3s ease;
        }

        @media (min-width: 768px) {
            #score {
                font-size: 48px;
            }
        }

        #livesPanel {
            display: flex;
            gap: 8px;
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.98) 0%, 
                rgba(250,240,240,0.98) 100%);
            padding: 15px 20px;
            border-radius: 18px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,1),
                0 0 20px rgba(255, 107, 107, 0.3);
            border: 2px solid rgba(255,255,255,0.6);
        }

        @media (min-width: 768px) {
            #livesPanel {
                padding: 22px 30px;
                gap: 12px;
            }
        }

        .heart {
            font-size: 28px;
            transition: all 0.4s;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
        }

        @media (min-width: 768px) {
            .heart {
                font-size: 35px;
            }
        }

        .heart.lost {
            opacity: 0.2;
            filter: grayscale(100%) blur(1px);
            transform: scale(0.7);
        }

        /* INDICATORE VELOCIT√Ä */
        #speedIndicator {
            position: absolute;
            top: 80px;
            left: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,240,240,0.95) 100%);
            padding: 12px 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.5);
            z-index: 100;
        }

        @media (min-width: 768px) {
            #speedIndicator {
                top: 120px;
                left: 35px;
                padding: 15px 25px;
            }
        }

        #speedIndicator div:first-child {
            font-size: 9px;
            color: #888;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 4px;
        }

        @media (min-width: 768px) {
            #speedIndicator div:first-child {
                font-size: 11px;
                margin-bottom: 5px;
            }
        }

        #speedValue {
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, #f77062 0%, #fe5196 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Press Start 2P', cursive;
        }

        @media (min-width: 768px) {
            #speedValue {
                font-size: 28px;
            }
        }

        /* INDICATORE VOCALE */
        #voiceIndicator {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
            box-shadow: 
                0 12px 35px rgba(238, 90, 111, 0.6),
                0 0 30px rgba(255, 107, 107, 0.4),
                inset 0 2px 0 rgba(255,255,255,0.3);
            z-index: 100;
            transition: all 0.3s;
            border: 4px solid rgba(255,255,255,0.5);
            cursor: pointer;
            animation: voiceGlow 2s ease-in-out infinite;
        }

        @media (min-width: 768px) {
            #voiceIndicator {
                bottom: 40px;
                right: 40px;
                width: 85px;
                height: 85px;
                font-size: 42px;
            }
        }

        @keyframes voiceGlow {
            0%, 100% {
                box-shadow: 
                    0 12px 35px rgba(238, 90, 111, 0.6),
                    0 0 30px rgba(255, 107, 107, 0.4),
                    inset 0 2px 0 rgba(255,255,255,0.3);
            }
            50% {
                box-shadow: 
                    0 12px 35px rgba(238, 90, 111, 0.8),
                    0 0 50px rgba(255, 107, 107, 0.8),
                    inset 0 2px 0 rgba(255,255,255,0.3);
            }
        }

        #voiceIndicator.active {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            box-shadow: 
                0 12px 40px rgba(81, 207, 102, 0.8),
                0 0 50px rgba(81, 207, 102, 0.9);
            transform: scale(1.2);
        }

        #voiceIndicator.listening::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid rgba(81, 207, 102, 0.8);
            animation: voiceRipple 2s ease-out infinite;
        }

        @keyframes voiceRipple {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.8);
                opacity: 0;
            }
        }

        /* SCHERMATE */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 90%, rgba(81, 207, 102, 0.2) 0%, transparent 50%),
                rgba(0, 0, 0, 0.94);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            backdrop-filter: blur(15px);
            animation: screenFadeIn 0.5s ease-out;
            overflow-y: auto;
            padding: 20px;
        }

        @keyframes screenFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .screen h1 {
            color: white;
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 
                0 5px 25px rgba(0,0,0,0.6),
                0 0 60px rgba(255,215,0,0.3);
            letter-spacing: 3px;
            font-family: 'Press Start 2P', cursive;
            text-align: center;
            line-height: 1.3;
            background: linear-gradient(45deg, #fff, #ffd700, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShine 3s ease-in-out infinite;
            background-size: 200% auto;
        }

        @media (min-width: 768px) {
            .screen h1 {
                font-size: 72px;
                margin-bottom: 20px;
            }
        }

        @keyframes titleShine {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        .screen h1 .rooster-emoji {
            display: inline-block;
            animation: roosterBounce 1.2s ease-in-out infinite;
            font-size: 48px;
        }

        @media (min-width: 768px) {
            .screen h1 .rooster-emoji {
                font-size: 75px;
            }
        }

        @keyframes roosterBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        .subtitle {
            color: rgba(255,255,255,0.95);
            font-size: 16px;
            margin-bottom: 20px;
            font-weight: 600;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            text-align: center;
            padding: 0 10px;
        }

        @media (min-width: 768px) {
            .subtitle {
                font-size: 22px;
                margin-bottom: 30px;
            }
        }

        #instructions {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.15) 0%, 
                rgba(255, 255, 255, 0.08) 100%);
            padding: 20px 25px;
            border-radius: 20px;
            margin: 0 10px 20px 10px;
            max-width: 800px;
            width: calc(100% - 20px);
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 
                0 15px 50px rgba(0,0,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.4);
        }

        @media (min-width: 768px) {
            #instructions {
                padding: 35px 50px;
                margin: 0 20px 30px 20px;
            }
        }

        #instructions p {
            color: white;
            font-size: 14px;
            margin: 12px 0;
            line-height: 1.5;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        @media (min-width: 768px) {
            #instructions p {
                font-size: 18px;
                margin: 16px 0;
                line-height: 1.6;
            }
        }

        #instructions p strong {
            color: #ffd43b;
            font-weight: 800;
            font-size: 16px;
            text-shadow: 0 0 10px rgba(255, 212, 59, 0.6);
        }

        @media (min-width: 768px) {
            #instructions p strong {
                font-size: 20px;
            }
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            width: 100%;
            max-width: 500px;
            padding: 0 10px;
        }

        @media (min-width: 768px) {
            .button-group {
                gap: 25px;
                margin-top: 30px;
                max-width: 700px;
            }
        }

        button {
            padding: 18px 40px;
            font-size: 20px;
            font-weight: 900;
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 
                0 8px 20px rgba(74, 144, 226, 0.4),
                0 0 0 3px rgba(255,255,255,0.3),
                inset 0 2px 0 rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            overflow: visible;
            width: 100%;
            max-width: 350px;
            z-index: 1000;
        }

        @media (min-width: 768px) {
            button {
                padding: 25px 60px;
                font-size: 28px;
                max-width: 400px;
            }
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        button:active {
            transform: translateY(-2px) scale(0.98);
        }

        button.secondary {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            box-shadow: 
                0 8px 20px rgba(81, 207, 102, 0.4),
                0 0 0 3px rgba(255,255,255,0.3),
                inset 0 2px 0 rgba(255,255,255,0.3);
        }

        #finalScore {
            color: #ffd43b;
            font-size: 42px;
            font-weight: 800;
            margin: 20px 0;
            text-shadow: 0 5px 25px rgba(255, 212, 59, 0.6);
            font-family: 'Press Start 2P', cursive;
        }

        @media (min-width: 768px) {
            #finalScore {
                font-size: 56px;
                margin: 30px 0;
            }
        }

        #highScore {
            color: rgba(255,255,255,0.8);
            font-size: 18px;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            #highScore {
                font-size: 24px;
                margin-bottom: 25px;
            }
        }

        #status {
            color: #ffd43b;
            font-size: 14px;
            margin-top: 15px;
            min-height: 25px;
            font-weight: 700;
            text-align: center;
            padding: 0 10px;
        }

        @media (min-width: 768px) {
            #status {
                font-size: 18px;
                margin-top: 25px;
            }
        }

        .hidden {
            display: none !important;
        }

        /* EFFETTO DANNO */
        @keyframes damageEffect {
            0%, 100% { 
                filter: drop-shadow(5px 8px 12px rgba(0,0,0,0.5)); 
            }
            25%, 75% { 
                filter: drop-shadow(0 0 25px rgba(255,0,0,1)) brightness(1.5);
            }
            50% {
                filter: drop-shadow(5px 8px 12px rgba(0,0,0,0.5));
            }
        }

        .damage {
            animation: damageEffect 0.6s ease-in-out;
        }

        /* PARTICELLE SALTO */
        .particle {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            z-index: 35;
            animation: particleRise 1.2s ease-out forwards;
        }

        @media (min-width: 768px) {
            .particle {
                font-size: 25px;
            }
        }

        @keyframes particleRise {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(0.3) rotate(360deg);
            }
        }

        /* PAUSA */
        #pauseOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 150;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        #pauseOverlay h2 {
            color: white;
            font-size: 42px;
            font-family: 'Press Start 2P', cursive;
            margin-bottom: 30px;
            text-shadow: 0 5px 25px rgba(255, 215, 0, 0.6);
        }

        @media (min-width: 768px) {
            #pauseOverlay h2 {
                font-size: 64px;
                margin-bottom: 40px;
            }
        }

        /* SCINTILLE */
        @keyframes sparkle {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(3) rotate(180deg);
                opacity: 0;
            }
        }

        .sparkle {
            position: absolute;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 2000;
            animation: sparkle 0.8s ease-out forwards;
        }

        /* DEBUG INFO */
        #debugInfo {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 8px 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            z-index: 150;
            display: none;
            line-height: 1.5;
        }

        @media (min-width: 768px) {
            #debugInfo {
                bottom: 20px;
                left: 20px;
                padding: 10px 15px;
                font-size: 12px;
            }
        }

        #debugInfo.show {
            display: block;
        }
    </style>
</head>
<body>
    <div id="gameWrapper">
        <div id="gameContainer">
            <!-- Sfondo -->
            <div class="sun"></div>
            <div class="cloud cloud1">‚òÅÔ∏è</div>
            <div class="cloud cloud2">‚òÅÔ∏è</div>
            <div class="cloud cloud3">‚òÅÔ∏è</div>
            <div class="mountain mountain1">üèîÔ∏è</div>
            <div class="mountain mountain2">‚õ∞Ô∏è</div>
            <div class="mountain mountain3">üèîÔ∏è</div>
            
            <!-- HUD -->
            <div id="hud">
                <div id="scorePanel">
                    <h3>Punteggio</h3>
                    <div id="score">0</div>
                </div>
                <div id="livesPanel">
                    <span class="heart" id="heart1">‚ù§Ô∏è</span>
                    <span class="heart" id="heart2">‚ù§Ô∏è</span>
                    <span class="heart" id="heart3">‚ù§Ô∏è</span>
                </div>
            </div>
            
            <!-- Indicatore Velocit√† -->
            <div id="speedIndicator">
                <div>Velocit√†</div>
                <div id="speedValue">1.0x</div>
            </div>
            
            <!-- Indicatore Vocale -->
            <div id="voiceIndicator" title="Controllo Vocale">üé§</div>
            
            <!-- GALLO -->
            <div id="rooster" class="running">üêì</div>
            
            <!-- Erba -->
            <div class="grass-container" id="grassContainer"></div>
            
            <!-- Terreno -->
            <div id="ground"></div>

            <!-- Debug Info -->
            <div id="debugInfo">
                <div>üéÆ DEBUG MODE</div>
                <div id="debugLives">Vite: 3</div>
                <div id="debugInvincible">Invincibile: NO</div>
                <div id="debugObstacles">Ostacoli: 0</div>
                <div id="debugLastAction">Ultima azione: -</div>
            </div>

            <!-- Schermata Pausa -->
            <div id="pauseOverlay" class="hidden">
                <h2>‚è∏Ô∏è PAUSA</h2>
                <p class="subtitle">Premi P o ESC per continuare</p>
            </div>

            <!-- Schermata Iniziale -->
            <div id="startScreen" class="screen">
                <h1>
                    <span class="rooster-emoji">üêì</span><br>
                    ROOSTER<br>RUNNER
                </h1>
                <p class="subtitle">Il Gallo pi√π Veloce del Mondo!</p>
                <div id="instructions">
                    <p><strong>üé§ VOCE:</strong> Fai rumore per saltare!</p>
                    <p><strong>‚å®Ô∏è TASTIERA:</strong> Premi SPAZIO per saltare, P per pausa</p>
                    <p><strong>üì± TOUCH:</strong> Tocca lo schermo per saltare</p>
                    <p><strong>‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è 3 VITE:</strong> Hai 3 vite! Ogni collisione = -1 vita</p>
                    <p><strong>üéØ OBIETTIVO:</strong> Evita gli ostacoli e guadagna punti!</p>
                    <p><strong>‚ö° DIFFICOLT√Ä:</strong> Il gioco diventa sempre pi√π veloce!</p>
                </div>
                <div class="button-group">
                    <button id="startBtn">üé§ GIOCA CON MICROFONO</button>
                    <button id="testBtn" class="secondary">‚å®Ô∏è GIOCA CON TASTIERA</button>
                </div>
                <p id="status"></p>
            </div>

            <!-- Schermata Game Over -->
            <div id="gameOverScreen" class="screen hidden">
                <h1>üí• GAME OVER üí•</h1>
                <div id="finalScore">0</div>
                <p id="highScore"></p>
                <p class="subtitle">Il gallo ha perso tutte le vite!</p>
                <div class="button-group">
                    <button id="restartBtn">üîÑ RIPROVA</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== ELEMENTI DOM ==========
        const rooster = document.getElementById('rooster');
        const gameContainer = document.getElementById('gameContainer');
        const scoreElement = document.getElementById('score');
        const speedValueElement = document.getElementById('speedValue');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const pauseOverlay = document.getElementById('pauseOverlay');
        const startBtn = document.getElementById('startBtn');
        const testBtn = document.getElementById('testBtn');
        const restartBtn = document.getElementById('restartBtn');
        const voiceIndicator = document.getElementById('voiceIndicator');
        const finalScoreElement = document.getElementById('finalScore');
        const highScoreElement = document.getElementById('highScore');
        const statusElement = document.getElementById('status');
        const grassContainer = document.getElementById('grassContainer');
        const debugInfo = document.getElementById('debugInfo');
        const debugLives = document.getElementById('debugLives');
        const debugInvincible = document.getElementById('debugInvincible');
        const debugObstacles = document.getElementById('debugObstacles');
        const debugLastAction = document.getElementById('debugLastAction');
        const hearts = [
            document.getElementById('heart1'),
            document.getElementById('heart2'),
            document.getElementById('heart3')
        ];

        // ========== VARIABILI DI GIOCO ==========
        let score = 0;
        let highScore = parseInt(localStorage.getItem('roosterHighScore')) || 0;
        let lives = 3;
        let isJumping = false;
        let gameActive = false;
        let gamePaused = false;
        let obstacles = [];
        let gameLoopId = null;
        let obstacleIntervalId = null;
        let difficultyIntervalId = null;
        let speedMultiplier = 1;
        let invincible = false;
        let usingVoice = false;
        let lastJumpTime = 0;
        const JUMP_COOLDOWN = 300;
        
        // ========== AUDIO ==========
        let audioContext = null;
        let analyser = null;
        let microphone = null;
        let dataArray = null;
        let isListening = false;
        let voiceCheckId = null;

        // ========== COSTANTI OTTIMIZZATE ==========
        const JUMP_HEIGHT = 250; // AUMENTATO DA 180 A 250 - Salto molto pi√π alto!
        const JUMP_DURATION = 700;
        const BASE_OBSTACLE_SPEED = 8;
        const BASE_OBSTACLE_INTERVAL = 1600;
        const VOICE_THRESHOLD = 30;
        const INVINCIBLE_TIME = 1500;
        const MAX_SPEED_MULTIPLIER = 3.5;
        const DIFFICULTY_INCREASE_RATE = 500;

        // ========== INIZIALIZZA ERBA ==========
        function initGrass() {
            grassContainer.innerHTML = '';
            for (let i = 0; i < 50; i++) {
                const grass = document.createElement('div');
                grass.classList.add('grass');
                grass.textContent = 'üåø';
                grass.style.left = (i * 30) + 'px';
                grass.style.animationDelay = (i * 0.1) + 's';
                grassContainer.appendChild(grass);
            }
        }

        // ========== AGGIORNA DEBUG INFO ==========
        function updateDebugInfo(action = null) {
            if (debugLives) debugLives.textContent = `Vite: ${lives}`;
            if (debugInvincible) debugInvincible.textContent = `Invincibile: ${invincible ? 'S√å' : 'NO'}`;
            if (debugObstacles) debugObstacles.textContent = `Ostacoli: ${obstacles.length}`;
            if (action && debugLastAction) {
                debugLastAction.textContent = `Ultima azione: ${action}`;
            }
        }

        // ========== SISTEMA SUONI ==========
        function playSound(type) {
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch(type) {
                    case 'jump':
                        oscillator.frequency.setValueAtTime(220, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(660, audioContext.currentTime + 0.15);
                        gainNode.gain.setValueAtTime(0.25, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.15);
                        break;
                        
                    case 'hit':
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.3);
                        gainNode.gain.setValueAtTime(0.35, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.3);
                        break;
                        
                    case 'score':
                        oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(1320, audioContext.currentTime + 0.05);
                        gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.08);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.08);
                        break;
                        
                    case 'gameOver':
                        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(110, audioContext.currentTime + 0.5);
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                        break;
                }
            } catch (error) {
                console.error('Errore riproduzione suono:', error);
            }
        }

        // ========== INIZIALIZZA AUDIO ==========
        async function initAudio() {
            try {
                statusElement.textContent = 'üé§ Attivazione microfono...';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: false,
                        noiseSuppression: false,
                        autoGainControl: false
                    } 
                });
                
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 512;
                analyser.smoothingTimeConstant = 0.3;
                
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                
                const bufferLength = analyser.frequencyBinCount;
                dataArray = new Uint8Array(bufferLength);
                
                isListening = true;
                usingVoice = true;
                voiceIndicator.classList.add('listening');
                statusElement.textContent = '‚úÖ Microfono Attivo! Fai Rumore per Saltare!';
                
                monitorVoice();
                return true;
            } catch (error) {
                console.error('Errore microfono:', error);
                statusElement.textContent = '‚ùå Microfono non disponibile - Usa tastiera o touch!';
                usingVoice = false;
                return false;
            }
        }

        // ========== MONITORA VOCE ==========
        function monitorVoice() {
            if (!analyser || !isListening) return;

            analyser.getByteFrequencyData(dataArray);
            
            let sum = 0;
            const relevantRange = Math.floor(dataArray.length * 0.3);
            for (let i = 0; i < relevantRange; i++) {
                sum += dataArray[i];
            }
            const average = sum / relevantRange;

            if (average > VOICE_THRESHOLD * 0.5) {
                voiceIndicator.style.transform = `scale(${1 + (average / 255) * 0.3})`;
            } else {
                voiceIndicator.style.transform = 'scale(1)';
            }

            const now = Date.now();
            if (average > VOICE_THRESHOLD && 
                gameActive && 
                !gamePaused &&
                !isJumping && 
                (now - lastJumpTime) > JUMP_COOLDOWN) {
                jump();
            }

            voiceCheckId = requestAnimationFrame(monitorVoice);
        }

        // ========== STOP VOICE MONITORING ==========
        function stopVoiceMonitoring() {
            isListening = false;
            if (voiceCheckId) {
                cancelAnimationFrame(voiceCheckId);
                voiceCheckId = null;
            }
            if (microphone) {
                try {
                    const tracks = microphone.mediaStream.getTracks();
                    tracks.forEach(track => track.stop());
                } catch (error) {
                    console.error('Errore stop microfono:', error);
                }
            }
        }

        // ========== CREA PARTICELLE ==========
        function createParticles() {
            const particles = ['‚ú®', '‚≠ê', 'üí´', 'üåü', 'üí®'];
            const particleCount = 5;
            
            for (let i = 0; i < particleCount; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    
                    const randomOffset = (Math.random() - 0.5) * 60;
                    const roosterRect = rooster.getBoundingClientRect();
                    particle.style.left = (roosterRect.left + roosterRect.width / 2 + randomOffset) + 'px';
                    particle.style.bottom = (parseInt(window.getComputedStyle(rooster).bottom) || 120) + 'px';
                    
                    gameContainer.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.remove();
                        }
                    }, 1200);
                }, i * 80);
            }
        }

        // ========== FUNZIONE SALTO MIGLIORATA ==========
        function jump() {
            if (isJumping || !gameActive || gamePaused) return;
            
            const now = Date.now();
            if ((now - lastJumpTime) < JUMP_COOLDOWN) return;
            
            lastJumpTime = now;
            isJumping = true;
            
            voiceIndicator.classList.add('active');
            rooster.classList.remove('running');
            createParticles();
            playSound('jump');
            
            // Calcola altezza di partenza in base alla media query
            let startBottom = 120; // Default mobile
            if (window.innerWidth >= 768) {
                startBottom = 150; // Desktop/tablet
            } else if (window.innerWidth <= 480) {
                startBottom = 100; // Mobile piccolo
            }
            
            const jumpStart = Date.now();

            function animateJump() {
                if (!gameActive || gamePaused) {
                    rooster.style.bottom = startBottom + 'px';
                    rooster.style.transform = 'scaleX(-1) rotate(0deg) scale(1)';
                    isJumping = false;
                    rooster.classList.add('running');
                    voiceIndicator.classList.remove('active');
                    return;
                }

                const elapsed = Date.now() - jumpStart;
                const progress = Math.min(elapsed / JUMP_DURATION, 1);

                if (progress < 1) {
                    const jumpProgress = Math.sin(progress * Math.PI);
                    const currentBottom = startBottom + (JUMP_HEIGHT * jumpProgress);
                    
                    const rotation = Math.sin(progress * Math.PI * 2) * 20;
                    const scale = 1 + jumpProgress * 0.15;
                    
                    rooster.style.bottom = currentBottom + 'px';
                    rooster.style.transform = `scaleX(-1) rotate(${rotation}deg) scale(${scale})`;
                    
                    requestAnimationFrame(animateJump);
                } else {
                    rooster.style.bottom = startBottom + 'px';
                    rooster.style.transform = 'scaleX(-1) rotate(0deg) scale(1)';
                    isJumping = false;
                    if (gameActive && !gamePaused) {
                        rooster.classList.add('running');
                    }
                    voiceIndicator.classList.remove('active');
                }
            }

            animateJump();
        }

        // ========== CREA OSTACOLO ==========
        function createObstacle() {
            if (!gameActive || gamePaused) return;

            const obstacle = document.createElement('div');
            obstacle.classList.add('obstacle');
            
            const obstacleTypes = [
                'üåµ', 'üå≤', 'üå≥', 'üå¥', 'üéã', 'üéç', 'ü™µ', 'üçÇ', 'üåø', 'ü™¥',
                'ü™®', 'üíé', '‚õ∞Ô∏è', 'üóø', 'üèîÔ∏è', '‚õèÔ∏è',
                'üî•', '‚ö°', '‚òÑÔ∏è', 'üí•', '‚ö†Ô∏è', '‚ò¢Ô∏è', 'üå™Ô∏è',
                'üß±', 'üöß', 'üì¶', 'üõ¢Ô∏è', '‚öôÔ∏è', 'üî©', 'ü™ì',
                'ü¶î', 'üêç', 'ü¶Ç', 'üï∑Ô∏è', 'üêù', 'ü¶á',
                'üíÄ', '‚ò†Ô∏è', 'ü¶¥', 'ü™¶',
                '‚öîÔ∏è', 'üó°Ô∏è', 'üî±', 'ü™É', 'üí£', 'üß®',
                'üö´', '‚õî', 'üî¥', '‚ùå',
                '‚ùÑÔ∏è', 'üå©Ô∏è'
            ];
            
            obstacle.textContent = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
            obstacle.style.right = '-100px';
            
            // Calcola bottom in base alla media query (stessa del rooster)
            let bottomPosition = 120;
            if (window.innerWidth >= 768) {
                bottomPosition = 150;
            } else if (window.innerWidth <= 480) {
                bottomPosition = 100;
            }
            obstacle.style.bottom = bottomPosition + 'px';
            
            obstacle.scored = false;
            obstacle.hit = false;
            obstacle.passedRooster = false;
            
            gameContainer.appendChild(obstacle);
            obstacles.push(obstacle);
        }

        // ========== PERDI VITA ==========
        function loseLife() {
            if (invincible || !gameActive) {
                console.log('‚ùå Danno bloccato - invincibile o gioco non attivo');
                return;
            }
            
            console.log(`üíî Vita persa! Vite rimanenti: ${lives - 1}`);
            
            invincible = true;
            lives--;
            
            updateDebugInfo(`üíî Vita persa! Rimanenti: ${lives}`);
            
            if (lives >= 0 && lives < hearts.length) {
                hearts[lives].classList.add('lost');
            }
            
            playSound('hit');
            rooster.classList.add('damage');
            setTimeout(() => {
                if (rooster) {
                    rooster.classList.remove('damage');
                }
            }, 600);
            
            if (lives <= 0) {
                console.log('‚ò†Ô∏è Game Over - nessuna vita rimasta');
                invincible = false;
                endGame();
                return;
            }
            
            console.log(`üõ°Ô∏è Invincibilit√† attivata per ${INVINCIBLE_TIME}ms`);
            let blinkCount = 0;
            const blinkDuration = 150;
            const totalBlinks = Math.floor(INVINCIBLE_TIME / blinkDuration);
            
            const blinkInterval = setInterval(() => {
                if (!gameActive) {
                    clearInterval(blinkInterval);
                    rooster.style.opacity = '1';
                    invincible = false;
                    updateDebugInfo('Invincibilit√† terminata');
                    return;
                }
                
                rooster.style.opacity = (blinkCount % 2 === 0) ? '0.3' : '1';
                blinkCount++;
                
                if (blinkCount >= totalBlinks) {
                    clearInterval(blinkInterval);
                    rooster.style.opacity = '1';
                    invincible = false;
                    updateDebugInfo('‚úÖ Invincibilit√† terminata');
                    console.log('‚úÖ Invincibilit√† terminata');
                }
            }, blinkDuration);
        }

        // ========== GAME LOOP ==========
        function gameLoop() {
            if (!gameActive || gamePaused) return;

            const difficultyLevel = Math.floor(score / DIFFICULTY_INCREASE_RATE);
            speedMultiplier = Math.min(1 + (difficultyLevel * 0.25), MAX_SPEED_MULTIPLIER);
            
            if (speedValueElement) {
                speedValueElement.textContent = speedMultiplier.toFixed(1) + 'x';
                if (speedMultiplier >= 2.5) {
                    speedValueElement.style.background = 'linear-gradient(135deg, #ff0000 0%, #ff6b6b 100%)';
                } else if (speedMultiplier >= 1.5) {
                    speedValueElement.style.background = 'linear-gradient(135deg, #ff6b00 0%, #ffa500 100%)';
                } else {
                    speedValueElement.style.background = 'linear-gradient(135deg, #f77062 0%, #fe5196 100%)';
                }
                speedValueElement.style.webkitBackgroundClip = 'text';
                speedValueElement.style.webkitTextFillColor = 'transparent';
            }
            
            updateDebugInfo();

            const roosterRect = rooster.getBoundingClientRect();

            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                
                const currentRight = parseFloat(obstacle.style.right) || 0;
                const speed = BASE_OBSTACLE_SPEED * speedMultiplier;
                const newRight = currentRight + speed;
                obstacle.style.right = newRight + 'px';

                const obstacleRect = obstacle.getBoundingClientRect();

                // SISTEMA COLLISIONE ULTRA-SICURO con hitbox pi√π piccole
                if (gameActive && 
                    !invincible && 
                    !obstacle.hit && 
                    obstacleRect.right > 0 && 
                    obstacleRect.left < window.innerWidth) {
                    
                    const hasCollision = checkCollision(roosterRect, obstacleRect);
                    
                    if (hasCollision) {
                        console.log('üí• COLLISIONE RILEVATA!');
                        obstacle.hit = true;
                        
                        obstacle.style.filter = 'brightness(2) drop-shadow(0 0 20px rgba(255,0,0,1))';
                        obstacle.style.transform = 'scale(1.3)';
                        setTimeout(() => {
                            if (obstacle.parentNode) {
                                obstacle.style.filter = 'drop-shadow(3px 5px 8px rgba(0,0,0,0.4))';
                                obstacle.style.transform = 'scale(1)';
                            }
                        }, 300);
                        
                        loseLife();
                    }
                }

                // SISTEMA PUNTEGGIO
                const safeDistance = 100;
                
                if (!obstacle.passedRooster && 
                    obstacleRect.right < roosterRect.left - safeDistance) {
                    obstacle.passedRooster = true;
                    console.log('‚úÖ Ostacolo passato completamente');
                }
                
                if (obstacle.passedRooster && !obstacle.scored && !obstacle.hit) {
                    obstacle.scored = true;
                    
                    const basePoints = 10;
                    const bonusPoints = Math.floor(speedMultiplier * 5);
                    const totalPoints = basePoints + bonusPoints;
                    
                    score += totalPoints;
                    scoreElement.textContent = score;
                    playSound('score');
                    
                    console.log(`üéØ +${totalPoints} punti!`);
                    updateDebugInfo(`üéØ +${totalPoints} punti!`);
                    
                    scoreElement.style.transform = 'scale(1.4)';
                    scoreElement.style.filter = 'brightness(1.6) drop-shadow(0 0 20px rgba(102, 126, 234, 0.8))';
                    
                    if (bonusPoints > 0) {
                        const bonusText = document.createElement('div');
                        bonusText.textContent = `+${totalPoints}`;
                        bonusText.style.position = 'absolute';
                        bonusText.style.left = roosterRect.left + 'px';
                        bonusText.style.top = (roosterRect.top - 30) + 'px';
                        bonusText.style.fontSize = '28px';
                        bonusText.style.fontWeight = 'bold';
                        bonusText.style.color = '#ffd43b';
                        bonusText.style.zIndex = '150';
                        bonusText.style.pointerEvents = 'none';
                        bonusText.style.animation = 'particleRise 1s ease-out forwards';
                        bonusText.style.textShadow = '0 0 10px rgba(255, 212, 59, 1)';
                        gameContainer.appendChild(bonusText);
                        setTimeout(() => {
                            if (bonusText.parentNode) {
                                bonusText.remove();
                            }
                        }, 1000);
                    }
                    
                    setTimeout(() => {
                        scoreElement.style.transform = 'scale(1)';
                        scoreElement.style.filter = 'brightness(1)';
                    }, 250);
                }

                if (newRight > window.innerWidth + 150) {
                    if (obstacle.parentNode) {
                        obstacle.remove();
                    }
                    obstacles.splice(i, 1);
                }
            }

            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // ========== COLLISIONE MIGLIORATA - Hitbox pi√π precise ==========
        function checkCollision(roosterRect, obstacleRect) {
            // Margini pi√π stretti per collisioni pi√π accurate
            const marginHorizontal = 30; // Ridotto da 25 a 30 per essere pi√π permissivi
            const marginVertical = 30;

            const collision = !(
                roosterRect.right - marginHorizontal < obstacleRect.left + marginHorizontal ||
                roosterRect.left + marginHorizontal > obstacleRect.right - marginHorizontal ||
                roosterRect.bottom - marginVertical < obstacleRect.top + marginVertical ||
                roosterRect.top + marginVertical > obstacleRect.bottom - marginVertical
            );

            return collision;
        }

        // ========== PAUSA GIOCO ==========
        function togglePause() {
            if (!gameActive) return;
            
            gamePaused = !gamePaused;
            
            if (gamePaused) {
                pauseOverlay.classList.remove('hidden');
                if (gameLoopId) {
                    cancelAnimationFrame(gameLoopId);
                    gameLoopId = null;
                }
                rooster.classList.remove('running');
            } else {
                pauseOverlay.classList.add('hidden');
                gameLoopId = requestAnimationFrame(gameLoop);
                if (!isJumping) {
                    rooster.classList.add('running');
                }
            }
        }

        // ========== INIZIA GIOCO ==========
        function startGame() {
            if (gameActive) return;
            
            console.log('=== INIZIO NUOVO GIOCO ===');
            
            gameActive = true;
            gamePaused = false;
            score = 0;
            lives = 3;
            speedMultiplier = 1;
            invincible = false;
            lastJumpTime = 0;
            scoreElement.textContent = score;
            
            hearts.forEach(heart => heart.classList.remove('lost'));
            
            obstacles.forEach(obs => {
                if (obs.parentNode) {
                    obs.remove();
                }
            });
            obstacles = [];
            
            if (gameLoopId) {
                cancelAnimationFrame(gameLoopId);
                gameLoopId = null;
            }
            if (obstacleIntervalId) {
                clearInterval(obstacleIntervalId);
                obstacleIntervalId = null;
            }
            if (difficultyIntervalId) {
                clearInterval(difficultyIntervalId);
                difficultyIntervalId = null;
            }
            
            // Reset posizione gallo in base alla media query
            let startBottom = 120;
            if (window.innerWidth >= 768) {
                startBottom = 150;
            } else if (window.innerWidth <= 480) {
                startBottom = 100;
            }
            rooster.style.bottom = startBottom + 'px';
            rooster.style.opacity = '1';
            rooster.style.transform = 'scaleX(-1) rotate(0deg) scale(1)';
            rooster.classList.add('running');
            
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            pauseOverlay.classList.add('hidden');

            gameLoopId = requestAnimationFrame(gameLoop);
            
            setTimeout(() => {
                if (gameActive) {
                    createObstacle();
                    
                    let currentInterval = BASE_OBSTACLE_INTERVAL;
                    
                    obstacleIntervalId = setInterval(() => {
                        if (!gamePaused && gameActive) {
                            createObstacle();
                        }
                    }, currentInterval);
                    
                    difficultyIntervalId = setInterval(() => {
                        if (!gameActive || gamePaused) return;
                        
                        const speedFactor = speedMultiplier;
                        const newInterval = Math.max(
                            700,
                            BASE_OBSTACLE_INTERVAL / (1 + (speedFactor - 1) * 0.5)
                        );
                        
                        currentInterval = newInterval;
                        
                        if (obstacleIntervalId) {
                            clearInterval(obstacleIntervalId);
                        }
                        
                        obstacleIntervalId = setInterval(() => {
                            if (!gamePaused && gameActive) {
                                createObstacle();
                            }
                        }, currentInterval);
                        
                        console.log(`Difficolt√† aumentata! Intervallo: ${currentInterval}ms, Velocit√†: ${speedMultiplier.toFixed(2)}x`);
                        
                    }, 10000);
                }
            }, 1500);
            
            console.log('Gioco iniziato - Buona fortuna!');
        }

        // ========== FINE GIOCO ==========
        function endGame() {
            gameActive = false;
            gamePaused = false;
            rooster.classList.remove('running');
            
            playSound('gameOver');
            
            if (gameLoopId) {
                cancelAnimationFrame(gameLoopId);
                gameLoopId = null;
            }
            if (obstacleIntervalId) {
                clearInterval(obstacleIntervalId);
                obstacleIntervalId = null;
            }
            if (difficultyIntervalId) {
                clearInterval(difficultyIntervalId);
                difficultyIntervalId = null;
            }
            
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('roosterHighScore', highScore.toString());
                highScoreElement.textContent = 'üèÜ NUOVO RECORD! üèÜ';
                highScoreElement.style.color = '#ffd43b';
                highScoreElement.style.fontSize = '28px';
            } else {
                highScoreElement.textContent = 'üèÜ Record Personale: ' + highScore;
                highScoreElement.style.color = 'rgba(255,255,255,0.8)';
                highScoreElement.style.fontSize = '20px';
            }
            
            finalScoreElement.textContent = score;
            gameOverScreen.classList.remove('hidden');
        }

        // ========== CREA SCINTILLE ==========
        function createSparkles(button) {
            const sparkleEmojis = ['‚ú®', '‚≠ê', 'üí´', 'üåü', '‚ö°', 'üí•'];
            const rect = button.getBoundingClientRect();
            
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.classList.add('sparkle');
                    sparkle.textContent = sparkleEmojis[Math.floor(Math.random() * sparkleEmojis.length)];
                    
                    const angle = (i / 12) * Math.PI * 2;
                    const distance = 60 + Math.random() * 40;
                    const x = rect.left + rect.width / 2 + Math.cos(angle) * distance;
                    const y = rect.top + rect.height / 2 + Math.sin(angle) * distance;
                    
                    sparkle.style.left = x + 'px';
                    sparkle.style.top = y + 'px';
                    sparkle.style.position = 'fixed';
                    
                    document.body.appendChild(sparkle);
                    
                    setTimeout(() => {
                        if (sparkle.parentNode) {
                            sparkle.remove();
                        }
                    }, 800);
                }, i * 30);
            }
        }

        // ========== EVENT LISTENERS ==========
        startBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            createSparkles(startBtn);
            await initAudio();
            setTimeout(() => startGame(), 600);
        });

        testBtn.addEventListener('click', (e) => {
            e.preventDefault();
            createSparkles(testBtn);
            statusElement.textContent = '‚å®Ô∏è Usa BARRA SPAZIATRICE, TOCCA lo schermo, o premi P per pausa!';
            usingVoice = false;
            startGame();
        });

        restartBtn.addEventListener('click', (e) => {
            e.preventDefault();
            createSparkles(restartBtn);
            if (usingVoice && audioContext) {
                isListening = true;
                voiceIndicator.classList.add('listening');
                monitorVoice();
            }
            startGame();
        });

        // Tastiera
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.key === ' ') {
                if (gameActive && !gamePaused) {
                    e.preventDefault();
                    jump();
                }
            } else if (e.code === 'KeyP' || e.key === 'p' || e.key === 'P') {
                e.preventDefault();
                togglePause();
            } else if (e.code === 'Escape' || e.key === 'Escape') {
                e.preventDefault();
                if (gameActive) {
                    togglePause();
                }
            } else if (e.code === 'KeyD' || e.key === 'd' || e.key === 'D') {
                e.preventDefault();
                if (debugInfo) {
                    debugInfo.classList.toggle('show');
                    console.log('Debug mode:', debugInfo.classList.contains('show') ? 'ON' : 'OFF');
                }
            }
        });

        // TOUCH - PREVIENE ZOOM SU MOBILE
        let touchStartTime = 0;
        gameContainer.addEventListener('touchstart', (e) => {
            touchStartTime = Date.now();
            if (gameActive && !gamePaused) {
                e.preventDefault();
                jump();
            }
        }, { passive: false });

        // Previeni comportamenti di default che causano zoom
        gameContainer.addEventListener('touchend', (e) => {
            e.preventDefault();
        }, { passive: false });

        gameContainer.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        // Click (per desktop)
        gameContainer.addEventListener('click', (e) => {
            if (gameActive && !gamePaused && e.target.tagName !== 'BUTTON') {
                jump();
            }
        });

        // Previeni doppio tap zoom
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });

        // Cleanup
        window.addEventListener('beforeunload', () => {
            stopVoiceMonitoring();
        });

        // Previeni scroll e refresh su mobile
        document.body.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        // ========== INIZIALIZZA ==========
        initGrass();
        
        if (highScore > 0) {
            statusElement.textContent = `üèÜ Record da Battere: ${highScore}`;
        }
    </script>
</body>
</html>
